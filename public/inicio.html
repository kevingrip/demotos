<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/components/nav.js"></script>
    <script src="/components/buttonAgregarCarrito.js"></script>

    <title>Document</title>
</head>

<body>

    <div id="index"></div>

    <script>

        async function cargarPagina() {

            const response = await fetch('/api/inicio')

            const data = await response.json()

            const products = data.result;  
            const catMongo = data.categories;  

            const index = document.getElementById('index')

            const header = document.createElement('header')
            const nav1 = getNav1()
            const nav2 = getNav2()
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            header.appendChild(nav1)
            header.appendChild(nav2)
            index.appendChild(header)

            const carouselResponse = await fetch('/components/carousel.html')
            const carouselHtml = await carouselResponse.text()
            const carouselContainer = document.createElement('div')
            carouselContainer.innerHTML = carouselHtml

            index.appendChild(carouselContainer)

            setTimeout(() => {
                const carouselElement = carouselContainer.querySelector('#carouselExampleIndicators')
                new bootstrap.Carousel(carouselElement, {
                    interval: 3000,
                    ride: 'carousel'
                })
            }, 100)

            let divProductPadre = document.createElement('div')

            console.log("catmongo:",catMongo)
            const categories = [...new Set(products.map(element => element.familia))];
            const divCategories = document.createElement('div')
            const titleCategory = document.createElement('h4')
            titleCategory.textContent='Categorias'
            titleCategory.classList.add('titleCategory')
            divCategories.appendChild(titleCategory)
            divCategories.classList.add('divCategories')
            categories.forEach(element => {
                catMongo.forEach(item =>{
                    if (item.title === element){
                        console.log(element)
                        const divCategoria = document.createElement('div')
                        const nombreCategoria = document.createElement('p')
                        nombreCategoria.textContent=element
                        const linkCategoria = document.createElement('a')
                        linkCategoria.classList.add('nombreCategoria')
                        nombreCategoria.classList.add('nombreCategoria')
                        const imgCategoria = document.createElement('img')
                        imgCategoria.src=`/uploads/${item.imagen}`
                        imgCategoria.classList.add('iconCategoria')
                        imgCategoria.alt=element
                        linkCategoria.appendChild(imgCategoria)
                        linkCategoria.href=`/productos.html?family=${element}`
                        divCategoria.appendChild(linkCategoria)
                        divCategoria.appendChild(nombreCategoria)
                        divCategories.appendChild(divCategoria)
                    }

                })
                
            });
            index.appendChild(divCategories)

            // products.forEach(element => {
            //     let cant = 1
            //     const precioProduct = (element.precio).toLocaleString('es-AR', {
            //         style: 'currency',
            //         currency: 'ARS',
            //         minimumFractionDigits: 2
            //     })

            //     const mayusElement = element.title.charAt(0).toUpperCase() + element.title.slice(1);

            //     const div = document.createElement('div')
            //     const divData = document.createElement('div')
            //     const img = document.createElement('img')
            //     const divImagen = document.createElement('a')
            //     const divTitle = document.createElement('a')
            //     const title = document.createElement('h3')
            //     const description = document.createElement('p')
            //     const precio = document.createElement('h4')

            //     divTitle.appendChild(title)
            //     divImagen.href = `item.html?codigo=${element.codigo}`
            //     divTitle.href = `item.html?codigo=${element.codigo}`
            //     divTitle.classList.add('divTitle')


            //     title.classList.add('tituloProducto')
            //     img.src = `/uploads/${element.imagen}`
            //     img.alt = element.title;
            //     img.classList.add('imgProduct')
            //     title.textContent = mayusElement
            //     description.textContent = element.description
            //     precio.textContent = precioProduct
            //     divImagen.classList.add('subBloqueProduct')
            //     divData.classList.add('subBloqueProduct')
            //     divImagen.appendChild(img)
            //     divData.appendChild(divTitle)
            //     // divData.appendChild(description)
            //     precio.classList.add('precioProducto')
            //     divData.appendChild(precio)
            //     div.appendChild(divImagen)
            //     div.appendChild(divData)
            //     title.classList.add('marginProduct')
            //     description.classList.add('marginProduct')
            //     precio.classList.add('marginProduct')
            //     div.classList.add('bloqueProduct')
            //     divProductPadre.appendChild(div)

            //     const buttonCantRest = document.createElement('button')
            //     const buttonCantSum = document.createElement('button')
            //     const cantidad = document.createElement('p')
            //     const buttonCompra = document.createElement('button')
            //     const divCantidad = document.createElement('div')
            //     const divCompra = document.createElement('div')
            //     const divCarrito = document.createElement('div')

            //     cantidad.textContent = cant
            //     buttonCantRest.classList.add('buttonCant')
            //     buttonCantSum.classList.add('buttonCant')
            //     cantidad.classList.add('cant')
            //     buttonCantRest.textContent = '-'
            //     buttonCantSum.textContent = '+'
            //     buttonCantSum.addEventListener('click', () => {
            //         cant += 1
            //         cantidad.textContent = cant
            //     })
            //     buttonCantRest.addEventListener('click', () => {
            //         if (cant > 1) {
            //             cant -= 1
            //             cantidad.textContent = cant
            //         }
            //     })
            //     buttonCompra.textContent = `Agregar al carrito`
            //     buttonCompra.classList.add('btn')
            //     buttonCompra.classList.add('colorButton')
            //     divCarrito.appendChild(buttonCompra)
            //     divCarrito.classList.add('divCarrito')
            //     divCantidad.appendChild(buttonCantRest)
            //     divCantidad.appendChild(cantidad)
            //     divCantidad.appendChild(buttonCantSum)
            //     divCantidad.classList.add('divCantidad')
            //     divCompra.appendChild(divCantidad)
            //     divCompra.appendChild(divCarrito)
            //     divCompra.classList.add('divCompra')
            //     divData.appendChild(divCompra)


            //     buttonCompra.addEventListener('click', () => {
            //         agregarAlCarrito(cart, element, cant);
            //     })
            // });


            divProductPadre.classList.add('contenedorProducts')

            index.appendChild(divProductPadre)

        }

        cargarPagina()




    </script>
</body>

</html>