<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <title>Document</title>
</head>

<body>

    <div id="index"></div>

    <script>

        async function cargarPagina() {

            const response = await fetch('/api/inicio')

            const products = await response.json()


                console.log(products)

                const index = document.getElementById('index')

                const header = document.createElement('header')
                header.style.backgroundColor = 'black'

                const nav = document.createElement('nav')
                const secondNav = document.createElement('nav')

                const navList = document.createElement('ul')
                const secondNavList = document.createElement('ul')
                navList.style.listStyle = 'none'
                navList.classList.add('navList')
                secondNavList.classList.add('secondNavList')

                const createNavBarItem = (titulo, link) => {
                    const navItem = document.createElement('li')
                    const item = document.createElement('a')
                    item.textContent = titulo
                    item.href = link
                    item.classList.add('itemNav')
                    navItem.appendChild(item)
                    navList.appendChild(navItem)
                    nav.appendChild(navList)
                    header.appendChild(nav)
                    index.appendChild(header)
                }

                const createSecondNavBarItem = (titulo, link) => {
                    const navItem = document.createElement('li')
                    const item = document.createElement('a')
                    item.textContent = titulo
                    item.href = link
                    navItem.appendChild(item)
                    item.classList.add('secondNavItem')
                    secondNavList.appendChild(navItem)
                    secondNav.appendChild(secondNavList)
                    header.appendChild(secondNav)
                    index.appendChild(header)
                }

                createNavBarItem('Inicio', '/inicio.html')

                const inputBuscador = document.createElement('input')
                inputBuscador.type = 'text'
                inputBuscador.placeholder = '    Buscar producto...'
                inputBuscador.classList.add('inputBuscador')
                navList.appendChild(inputBuscador)

                const navItemCart = document.createElement('li')
                const itemCart = document.createElement('a')
                const imgCart = document.createElement('img')
                imgCart.classList.add('imgCart')
                imgCart.src = './img/cart.png'
                imgCart.alt = 'carrito'
                itemCart.href = '/cart.html'
                itemCart.appendChild(imgCart)
                itemCart.classList.add('itemNav')
                navItemCart.appendChild(itemCart)
                navList.appendChild(navItemCart)
                nav.appendChild(navList)
                header.appendChild(nav)
                index.appendChild(header)

                createSecondNavBarItem('Productos', '/productos.html')
                createSecondNavBarItem('Envios', '/productos.html')
                createSecondNavBarItem('Ubicacion', '/productos.html')
                createSecondNavBarItem('Medios de pago', '/productos.html')

                inputBuscador.addEventListener('keydown', async (e) => {
                    if (e.key === 'Enter') {
                        const texto = e.target.value.trim()

                        try {
                            window.location.href = `/productos.html?title=${texto}`

                        } catch (error) {
                            console.error(error)
                            divProductPadre.innerHTML = `<p style="text-align:center">No se encontraron productos</p>`
                        }
                    }
                })

                const carouselResponse = await fetch('/components/carousel.html')
                const carouselHtml = await carouselResponse.text()
                const carouselContainer = document.createElement('div')
                carouselContainer.innerHTML = carouselHtml

                // Insertar carousel justo despuÃ©s del header
                index.appendChild(carouselContainer)


                let divProductPadre = document.createElement('div')

                let cart = JSON.parse(localStorage.getItem('cart')) || [];

                products.forEach(element => {
                    let cant = 1
                    const precioProduct = (element.precio).toLocaleString('es-AR', {
                        style: 'currency',
                        currency: 'ARS',
                        minimumFractionDigits: 2
                    })

                    const mayusElement = element.title.charAt(0).toUpperCase() + element.title.slice(1);

                    const div = document.createElement('div')
                    const divData = document.createElement('div')
                    const img = document.createElement('img')
                    const divImagen = document.createElement('a')
                    const divTitle = document.createElement('a')
                    const title = document.createElement('h3')
                    const description = document.createElement('p')
                    const precio = document.createElement('h4')

                    divTitle.appendChild(title)
                    divImagen.href = `item.html?codigo=${element.codigo}`
                    divTitle.href = `item.html?codigo=${element.codigo}`
                    divTitle.classList.add('divTitle')


                    title.classList.add('tituloProducto')
                    img.src = `/uploads/${element.imagen}`
                    img.alt = element.title;
                    img.classList.add('imgProduct')
                    title.textContent = mayusElement
                    description.textContent = element.description
                    precio.textContent = precioProduct
                    divImagen.classList.add('subBloqueProduct')
                    divData.classList.add('subBloqueProduct')
                    divImagen.appendChild(img)
                    divData.appendChild(divTitle)
                    // divData.appendChild(description)
                    precio.classList.add('precioProducto')
                    divData.appendChild(precio)
                    div.appendChild(divImagen)
                    div.appendChild(divData)
                    title.classList.add('marginProduct')
                    description.classList.add('marginProduct')
                    precio.classList.add('marginProduct')
                    div.classList.add('bloqueProduct')
                    divProductPadre.appendChild(div)

                    const buttonCantRest = document.createElement('button')
                    const buttonCantSum = document.createElement('button')
                    const cantidad = document.createElement('p')
                    const buttonCompra = document.createElement('button')
                    const divCantidad = document.createElement('div')
                    const divCompra = document.createElement('div')
                    const divCarrito = document.createElement('div')

                    cantidad.textContent = cant
                    buttonCantRest.classList.add('buttonCant')
                    buttonCantSum.classList.add('buttonCant')
                    cantidad.classList.add('cant')
                    buttonCantRest.textContent = '-'
                    buttonCantSum.textContent = '+'
                    buttonCantSum.addEventListener('click', () => {
                        cant += 1
                        cantidad.textContent = cant
                    })
                    buttonCantRest.addEventListener('click', () => {
                        if (cant > 1) {
                            cant -= 1
                            cantidad.textContent = cant
                        }
                    })
                    buttonCompra.textContent = `Agregar al carrito`
                    buttonCompra.classList.add('btn')
                    buttonCompra.classList.add('colorButton')
                    divCarrito.appendChild(buttonCompra)
                    divCarrito.classList.add('divCarrito')
                    divCantidad.appendChild(buttonCantRest)
                    divCantidad.appendChild(cantidad)
                    divCantidad.appendChild(buttonCantSum)
                    divCantidad.classList.add('divCantidad')
                    divCompra.appendChild(divCantidad)
                    divCompra.appendChild(divCarrito)
                    divCompra.classList.add('divCompra')
                    divData.appendChild(divCompra)


                    buttonCompra.addEventListener('click', () => {
                        const productsCart = cart.find(item => item.codigo === element.codigo)
                        if (productsCart) {
                            productsCart.cantidad += cant
                        } else {
                            cart.push({ codigo: element.codigo, cantidad: cant })
                        }
                        console.log(cart)
                        localStorage.setItem('cart', JSON.stringify(cart));

                        Swal.fire({
                            toast: true,
                            position: 'top-end',
                            icon: 'success',
                            title: 'Agregado al carrito',
                            showConfirmButton: false,
                            timer: 1300,
                            timerProgressBar: true,
                        });
                    })
                });

                divProductPadre.classList.add('contenedorProducts')

                index.appendChild(divProductPadre)

            }

            cargarPagina()
            



    </script>
</body>

</html>