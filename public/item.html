<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/components/nav.js"></script>
    <script src="/components/buttonAgregarCarrito.js"></script>
    <title>Document</title>
</head>

<body>

    <div id="products"></div>

    <script>

        const params = new URLSearchParams(window.location.search);
        const codigo = params.get('codigo')?.toLowerCase();

        let url = `/api/productos?codigo=${codigo}`


        fetch(url)
            .then(response => response.json())
            .then(products => {


                const page = document.getElementById('products')
                const allProducts = document.createElement('div')
                const buscador = document.createElement('div')

                const header = document.createElement('header')
                const nav1 = getNav1()
                const nav2 = getNav2()
                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                header.appendChild(nav1)
                page.appendChild(header)


                const divPag = document.createElement('div')
                const divTextPag = document.createElement('a')
                divTextPag.textContent = 'Productos'
                divTextPag.href = `/productos.html`
                divTextPag.classList.add('divTextPag')
                divPag.classList.add('divPag')
                divTextPag.classList.add('divTextPag')
                divPag.appendChild(divTextPag)

                let divProductPadre = document.createElement('div')

                products.forEach(element => {

                    const mayusTitle = element.title.charAt(0).toUpperCase() + element.title.slice(1);
                    const mayusDescription = element.description.charAt(0).toUpperCase() + element.description.slice(1);

                    let cant = 1

                    const precioProduct = (element.precio).toLocaleString('es-AR', {
                        style: 'currency',
                        currency: 'ARS',
                        minimumFractionDigits: 2
                    })
                    const div = document.createElement('div')
                    const divImagen = document.createElement('div')
                    const divDataItem = document.createElement('div')
                    const img = document.createElement('img')
                    const title = document.createElement('h3')
                    const description = document.createElement('p')
                    const precio = document.createElement('h4')
                    const buttonCompra = document.createElement('button')
                    const divCompra = document.createElement('div')

                    title.classList.add('tituloProductoItem')
                    img.src = `/uploads/${element.imagen}`
                    img.alt = element.title;
                    img.classList.add('imgProductItem')
                    title.textContent = mayusTitle
                    description.textContent = mayusDescription
                    precio.textContent = `${precioProduct}`
                    description.classList.add('description')
                    buttonCompra.textContent = `Agregar al carrito`
                    buttonCompra.classList.add('btn')
                    buttonCompra.classList.add('colorButton')
                    divCompra.appendChild(buttonCompra)
                    divImagen.classList.add('divImg')
                    divDataItem.classList.add('divDataItem')
                    divImagen.appendChild(img)
                    divDataItem.appendChild(title)
                    divDataItem.appendChild(description)
                    precio.classList.add('precioPageProducto')
                    divDataItem.appendChild(precio)

                    const divTransfer = document.createElement('div')
                    const transfer = document.createElement('p')
                    transfer.classList.add('transfer')
                    transfer.textContent = '10% de descuento pagando con Transferencia o depÃ³sito'
                    divDataItem.appendChild(transfer)

                    const buttonCantRest = document.createElement('button')
                    const buttonCantSum = document.createElement('button')
                    const cantidad = document.createElement('p')
                    const divCantidad = document.createElement('div')
                    const divCarrito = document.createElement('div')

                    cantidad.textContent = cant
                    buttonCantRest.classList.add('buttonCantItem')
                    buttonCantSum.classList.add('buttonCantItem')
                    cantidad.classList.add('cantItem')
                    buttonCantRest.textContent = '-'
                    buttonCantSum.textContent = '+'
                    buttonCantSum.addEventListener('click', () => {
                        cant += 1
                        cantidad.textContent = cant
                    })
                    buttonCantRest.addEventListener('click', () => {
                        if (cant > 1) {
                            cant -= 1
                            cantidad.textContent = cant
                        }
                    })
                    buttonCompra.textContent = `Agregar al carrito`
                    buttonCompra.classList.add('btn')
                    buttonCompra.classList.add('colorButton')
                    divCarrito.appendChild(buttonCompra)
                    divCarrito.classList.add('divCarritoItem')

                    divCantidad.appendChild(buttonCantRest)
                    divCantidad.appendChild(cantidad)
                    divCantidad.appendChild(buttonCantSum)
                    divCantidad.classList.add('divCantidadItem')
                    divCompra.appendChild(divCantidad)
                    divCompra.appendChild(divCarrito)
                    divCompra.classList.add('divCompraItem')

                    divDataItem.appendChild(divCompra)
                    div.appendChild(divImagen)
                    div.appendChild(divDataItem)
                    title.classList.add('marginProduct')
                    description.classList.add('marginProduct')
                    precio.classList.add('marginProduct')
                    div.classList.add('bloqueItemProduct')
                    divProductPadre.appendChild(div)

                    buttonCompra.addEventListener('click', () => {
                        agregarAlCarrito(cart, element, cant);
                    })
                });

                divProductPadre.classList.add('contenedorProducts', 'marginBodyItem')

                header.appendChild(divPag)

                allProducts.appendChild(divProductPadre)

                buscador.classList.add('buscador')

                page.appendChild(allProducts)

            })



    </script>
</body>

</html>